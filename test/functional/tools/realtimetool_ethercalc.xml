<tool id="interactive_tool_ethercalc" tool_type="interactive" name="EtherCalc" version="0.1">
    <requirements>
        <container type="docker">shiltemann/ethercalc-galaxy-ie:17.05</container>
    </requirements>
    <entry_points>
        <entry_point name="ethercalc" requires_domain="True">
            <port>8000</port>
        </entry_point>
    </entry_points>
    <command><![CDATA[
    
        forever start `which ethercalc` --cors &

        ## make sure ethercalc has finished starting up
        STATUS=$(curl --include 'http://localhost:8000/_/galaxy' 2>&1)
        while [[ ${STATUS} =~ "refused" ]]
        do
          echo "waiting for ethercalc: $STATUS \n"
          STATUS=$(curl --include 'http://localhost:8000/_/galaxy' 2>&1)
          sleep 2
        done
        &&


        curl --include \
             --request POST \
             --header "Content-Type: application/json" \
             --data-binary "{ \"room\": \"galaxy\", \"snapshot\": \"...\"}"  \
        'http://localhost:8000/_'
        &&

        ## put loading message into worksheet in case of large files
        echo -e "Loading your,dataset\nThis may take, some time for, large files.." > loading.txt
        curl --include --request PUT --header "Content-Type: text/csv" --data-binary @loading.txt http://localhost:8000/_/galaxy

        &&
        ## remove dump file so this doesnt appear in audit trail
        rm /dump.json
        &&

        ## load dataset into worksheet
        curl --include --request PUT \
        --header "Content-Type: text/csv" \
        --data-binary $infile http://localhost:8000/_/galaxy
        &&

        tail -f /etc/hosts

    ]]>
    </command>
    <inputs>
        <param name="infile" type="data" format="tabular,csv,tsv" label="Some tabular dataset"/>
    </inputs>
    <outputs>
        <data name="out_file1" format="txt" />
    </outputs>
    <tests>
    </tests>
    <help>
        EtherCalc is a web spreadsheet.
        https://ethercalc.net
    </help>
</tool>
